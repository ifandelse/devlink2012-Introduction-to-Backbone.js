define(["postal","underscore"],function(a,b,c){a.diagnostics=a.diagnostics||{};var d=function(c,d,e){var f=this;f.filters=e||[],f.active=!0,f.removeWireTap=a.addWireTap(function(a,c){if(!f.active)return;if(!f.filters.length||b.any(f.filters,function(a){return f.applyFilter(a,c)})){if(!JSON)throw"This browser or environment does not provide JSON support";try{d(JSON.stringify(c))}catch(e){try{var g=b.extend({},c);delete g.data,d(JSON.stringify(g)+"\n	"+"JSON.stringify Error: "+e.message)}catch(h){d("Unable to parse data to JSON: "+e)}}}}),a.diagnostics[c]&&a.diagnostics[c].removeWireTap(),a.diagnostics[c]=f};return d.prototype.applyFilter=function(a,c){var d=0,e=0;return b.each(a,function(a,f){c[f]&&(e++,b.isRegExp(a)&&a.test(c[f])?d++:b.isObject(c[f])&&!b.isArray(c[f])?this.applyFilter(a,c[f])&&d++:b.isEqual(c[f],a)&&d++)},this),d===e},d.prototype.clearFilters=function(){this.filters=[]},d.prototype.removeFilter=function(a){this.filters=b.filter(this.filters,function(c){return!b.isEqual(c,a)})},d.prototype.addFilter=function(a){b.isArray(a)||(a=[a]),b.each(a,function(a){(this.filters.length===0||!b.any(this.filters,function(c){return b.isEqual(c,a)}))&&this.filters.push(a)},this)},d})