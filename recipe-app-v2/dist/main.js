//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.4.0
 * Released: 2011-02-04
 * Source:   http://github.com/appendto/jquery-mockjax
 * Docs:     http://enterprisejquery.com/2010/07/mock-your-ajax-requests-with-mockjax-for-rapid-development
 * Plugin:   mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 * 
 * Copyright (c) 2010 appendTo LLC.
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 */

/*
 postal.js
 Author: Jim Cowart
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.6.3
 */

/*
	aspect.js - (POC/alpha)
	Jim Cowart 2012
	dual licensed MIT/GPL
 */

/*
 RequireJS text 1.0.7 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*
 postal.diagnostics
 Author: Jim Cowart
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.6.1
 */

(function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}).call(this),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),define("infrastructure/comm/recipes",{0:{id:0,title:"Frozen Captain",description:"Ice Cream + Cap'n Crunch and more",items:["Your favorite ice cream flavor","Minimum 1-2 Cups of Cap'n Crunch cereal","Chocolate syrup"],steps:["Fill a bowl with generous amounts of your favorite ice cream.","Pour a minimum 1-1 1/2 cups of Capn' Crunch cereal over the top of the ice cream.","Drizzle chocolate syrup to desired amount over top of bowl.","Enjoy!"]},1:{id:1,title:"'Pretend You're Not on Paleo' Toast",description:"Toast that keeps a paleo guy sane",items:["Toaster Oven","Minimum 1 slice of gluten-free bread","At least half a tablespoon of real butter","1-3 tablespoons of organic strawberry preserves"],steps:["Spread a generous amount of butter on the slice of bread","Place the bread in the toaster oven. Be sure and watch the butter melt, as this helps convince the brain it's *real* bread","Once the bread is starting to turn golden brown, remove from toaster oven.","Spread a generous amount of the strawberry preserves over the toast","Ignore the sugar content of the preserves, and convince yourself that the gluten free bread and natural fat from the butter is all that matters","Consider having a slice of bacon with the toast. Bacon is paleo. Bacon is good. Bacon is BACON.","Repeat as necessary"]},2:{id:2,title:"Awesome Sauce",description:"It's epic beyond words...",items:["Awesome","Sauce","Lots and lots of time. LOTS."],steps:["1 Cup of Awesome","1 Cup of Sauce","Stir for about 10 years - until blended smooth.","Consume quickly - only lasts about 10 minutes"]}}),function(e){function r(t){window["DOMParser"]==undefined&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});try{var n=(new DOMParser).parseFromString(t,"text/xml");if(!e.isXMLDoc(n))throw"Unable to parse XML";var r=e("parsererror",n);if(r.length==1)throw"Error: "+e(n).text()}catch(i){var s=i.name==undefined?i:i.name+": "+i.message;return e(document).trigger("xmlParseError",[s]),undefined}return n}var t=e.ajax,n=[];e.extend({ajax:function(i){var s=jQuery.extend(!0,{},jQuery.ajaxSettings,i),o=!1;return e.each(n,function(u,a){if(!n[u])return;var f=null;if(e.isFunction(n[u]))f=n[u](s);else{f=n[u];if(e.isFunction(f.url.test))f.url.test(s.url)||(f=null);else{var l=f.url.indexOf("*");if(f.url!="*"&&f.url!=s.url&&l==-1||l>-1&&f.url.substr(0,l)!=s.url.substr(0,l))f=null}if(f){if(f.data&&s.data){var c=!1;(function S(t,n){if(typeof n=="string")return c=e.isFunction(t.test)?t.test(n):t==n,c;e.each(t,function(r,i){return n[r]===undefined?(c=!1,!1):(c=!0,typeof n[r]=="object"?S(t[r],n[r]):(e.isFunction(t[r].test)?c=t[r].test(n[r]):c=t[r]==n[r],c))})})(f.data,s.data),c==0&&(f=null)}f&&f.type&&f.type!=s.type&&(f=null)}}if(f){o=!0;var h=e.extend({},e.mockjaxSettings,f);h.log&&e.isFunction(h.log)&&h.log("MOCK "+s.type.toUpperCase()+": "+s.url,e.extend({},s));var p=/=\?(&|$)/,d=(new Date).getTime();if(s.dataType==="jsonp"){if(s.type.toUpperCase()==="GET")p.test(s.url)||(s.url+=(rquery.test(s.url)?"&":"?")+(s.jsonp||"callback")+"=?");else if(!s.data||!p.test(s.data))s.data=(s.data?s.data+"&":"")+(s.jsonp||"callback")+"=?";s.dataType="json"}s.dataType==="json"&&(s.data&&p.test(s.data)||p.test(s.url))&&(jsonp=s.jsonpCallback||"jsonp"+d++,s.data&&(s.data=(s.data+"").replace(p,"="+jsonp+"$1")),s.url=s.url.replace(p,"="+jsonp+"$1"),s.dataType="script",window[jsonp]=window[jsonp]||function(e){data=e,b(),w(),window[jsonp]=undefined;try{delete window[jsonp]}catch(t){}head&&head.removeChild(script)});var v=/^(\w+:)?\/\/([^\/?#]+)/,m=v.exec(s.url),g=m&&(m[1]&&m[1]!==location.protocol||m[2]!==location.host);if(s.dataType==="script"&&s.type.toUpperCase()==="GET"&&g){var y=i&&i.context||s;function b(){s.success&&s.success.call(y,f.response?f.response.toString():f.responseText||"",status,{}),s.global&&E("ajaxSuccess",[{},s])}function w(){s.complete&&s.complete.call(y,{},status),s.global&&E("ajaxComplete",[{},s]),s.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop")}function E(e,t){(s.context?jQuery(s.context):jQuery.event).trigger(e,t)}return f.response&&e.isFunction(f.response)?f.response(i):e.globalEval(f.responseText),b(),w(),!1}return o=t.call(e,e.extend(!0,{},i,{xhr:function(){return f=e.extend({},e.mockjaxSettings,f),f.contentType&&(f.headers["content-type"]=f.contentType),{status:f.status,readyState:1,open:function(){},send:function(){var n=function(t){return function(){return function(){e.isFunction(f.response)&&f.response(i),s.dataType=="json"&&typeof f.responseText=="object"?this.responseText=JSON.stringify(f.responseText):s.dataType=="xml"?typeof f.responseXML=="string"?this.responseXML=r(f.responseXML):this.responseXML=f.responseXML:this.responseText=f.responseText,this.status=f.status,this.readyState=4,e.isFunction(this.onreadystatechange)&&this.onreadystatechange(f.isTimeout?"timeout":undefined)}.apply(t)}}(this);f.proxy?t({global:!1,url:f.proxy,type:f.proxyType,data:f.data,dataType:s.dataType,complete:function(e,t){f.responseXML=e.responseXML,f.responseText=e.responseText,this.responseTimer=setTimeout(n,f.responseTime||0)}}):s.async===!1?n():this.responseTimer=setTimeout(n,f.responseTime||50)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(){},getResponseHeader:function(e){if(f.headers&&f.headers[e])return f.headers[e];if(e.toLowerCase()=="last-modified")return f.lastModified||(new Date).toString();if(e.toLowerCase()=="etag")return f.etag||"";if(e.toLowerCase()=="content-type")return f.contentType||"text/plain"},getAllResponseHeaders:function(){var t="";return e.each(f.headers,function(e,n){t+=e+": "+n+"\n"}),t}}}})),!1}}),o?o:t.apply(e,arguments)}}),e.mockjaxSettings={log:function(e){window.console&&window.console.log&&window.console.log(e)},status:200,responseTime:500,isTimeout:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},e.mockjax=function(e){var t=n.length;return n[t]=e,t},e.mockjaxClear=function(e){arguments.length==1?n[e]=null:n=[]}}(jQuery),define("mockjax",function(){}),define("infrastructure/comm/resource-mocks",["jquery","underscore","infrastructure/comm/recipes","mockjax"],function(e,t,n){var r=t.toArray(n).length;e.mockjax({url:"/api/recipe",type:"GET",status:200,response:function(e){this.responseText=JSON.stringify(t.toArray(n))}}),e.mockjax({url:/api.recipe.[0-9]{1,2}$/,type:"GET",response:function(e){var t=e.url.substr(e.url.lastIndexOf("/")+1),r=n[t];r?(this.status=200,this.responseText=JSON.stringify(r)):this.status=404}}),e.mockjax({url:"/api/recipe",type:"POST",status:200,response:function(e){var t=r++,i=JSON.parse(e.data);i.id=t,n[t]=i,this.responseText=JSON.stringify(i)}}),e.mockjax({url:/api.recipe.[0-9]{1,2}$/,type:"PUT",status:200,response:function(e){var t=JSON.parse(e.data);n[t.id]=t,this.responseText=JSON.stringify(t)}}),e.mockjax({url:/api.recipe.[0-9]{1,4}$/,type:"DELETE",status:200,response:function(e){var r=e.url.substr(e.url.lastIndexOf("/")+1);delete n[r],this.responseText=JSON.stringify(t.toArray(n))}})}),define("libs/deepExtend",["underscore"],function(e){var t=[].slice;if(!e.deepExtend){var n={"*":function(e,t,n){e[t]=n},object:function(e,t,n){e[t]=s(e[t]||{},n)},array:function(t,r,s){t[r]=[],e.each(s,function(e,s){n[i(e)](t[r],s,e)},this)}},r=function(t){return e.isArray(t)?"array":e.isDate(t)?"date":e.isRegExp(t)?"regex":typeof t},i=function(e){var t=r(e);return n[t]?t:"*"},s=function(r){return e.each(t.call(arguments,1),function(t){e.each(t,function(e,t){n[i(e)](r,t,e)})}),r};e.mixin({deepExtend:s})}}),define("postal",["underscore"],function(e,t){var n="/",r=50,i=0,s="postal",o=function(){},u=function(){var t;return function(n){var r=!1;return e.isString(n)?(r=n===t,t=n):(r=e.isEqual(n,t),t=e.clone(n)),!r}},a=function(e,t){this.channel=e||n,this._topic=t||""};a.prototype={subscribe:function(){var e=arguments.length;if(e===1)return new f(this.channel,this._topic,arguments[0]);if(e===2)return new f(this.channel,arguments[0],arguments[1])},publish:function(e){var t=e||{},n={channel:this.channel,topic:this._topic,data:t};return t.topic&&t.data&&(n=t,n.channel=n.channel||this.channel),n.timeStamp=new Date,v.configuration.bus.publish(n),n},topic:function(e){return e===this._topic?this:new a(this.channel,e)}};var f=function(e,t,n){this.channel=e,this.topic=t,this.callback=n,this.priority=r,this.constraints=new Array(0),this.maxCalls=i,this.onHandled=o,this.context=null,v.configuration.bus.publish({channel:s,topic:"subscription.created",timeStamp:new Date,data:{event:"subscription.created",channel:e,topic:t}}),v.configuration.bus.subscribe(this)};f.prototype={unsubscribe:function(){v.configuration.bus.unsubscribe(this),v.configuration.bus.publish({channel:s,topic:"subscription.removed",timeStamp:new Date,data:{event:"subscription.removed",channel:this.channel,topic:this.topic}})},defer:function(){var e=this.callback;return this.callback=function(t){setTimeout(e,0,t)},this},disposeAfter:function(t){if(e.isNaN(t)||t<=0)throw"The value provided to disposeAfter (maxCalls) must be a number greater than zero.";var n=this.onHandled,r=e.after(t,e.bind(function(){this.unsubscribe(this)},this));return this.onHandled=function(){n.apply(this.context,arguments),r()},this},ignoreDuplicates:function(){return this.withConstraint(new u),this},withConstraint:function(t){if(!e.isFunction(t))throw"Predicate constraint must be a function";return this.constraints.push(t),this},withConstraints:function(t){var n=this;return e.isArray(t)&&e.each(t,function(e){n.withConstraint(e)}),n},withContext:function(e){return this.context=e,this},withDebounce:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=e.debounce(n,t),this},withDelay:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=function(e){setTimeout(function(){n(e)},t)},this},withPriority:function(t){if(e.isNaN(t))throw"Priority must be a number";return this.priority=t,v.configuration.bus.changePriority(this),this},withThrottle:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=e.throttle(n,t),this},subscribe:function(e){return this.callback=e,this}};var l={cache:{},compare:function(e,t){if(this.cache[t]&&this.cache[t][e])return!0;var n=new RegExp("^"+e.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/#/g,"[A-Z,a-z,0-9]*")+"$"),r=n.test(t);return r&&(this.cache[t]||(this.cache[t]={}),this.cache[t][e]=!0),r},reset:function(){this.cache={}}},c={addWireTap:function(e){var t=this;return t.wireTaps.push(e),function(){var n=t.wireTaps.indexOf(e);n!==-1&&t.wireTaps.splice(n,1)}},changePriority:function(t){var n,r;if(this.subscriptions[t.channel]&&this.subscriptions[t.channel][t.topic]){this.subscriptions[t.channel][t.topic]=e.without(this.subscriptions[t.channel][t.topic],t),n=this.subscriptions[t.channel][t.topic].length-1;for(;n>=0;n--)if(this.subscriptions[t.channel][t.topic][n].priority<=t.priority){this.subscriptions[t.channel][t.topic].splice(n+1,0,t),r=!0;break}r||this.subscriptions[t.channel][t.topic].unshift(t)}},publish:function(t){e.each(this.wireTaps,function(e){e(t.data,t)}),e.each(this.subscriptions[t.channel],function(n){e.each(e.clone(n),function(n){v.configuration.resolver.compare(n.topic,t.topic)&&e.all(n.constraints,function(e){return e(t.data,t)})&&typeof n.callback=="function"&&(n.callback.apply(n.context,[t.data,t]),n.onHandled())})})},reset:function(){this.subscriptions&&(e.each(this.subscriptions,function(t){e.each(t,function(e){while(e.length)e.pop().unsubscribe()})}),this.subscriptions={})},subscribe:function(e){var t,n,r,i=this.subscriptions[e.channel],s;return i||(i=this.subscriptions[e.channel]={}),s=this.subscriptions[e.channel][e.topic],s||(s=this.subscriptions[e.channel][e.topic]=new Array(0)),s.push(e),e},subscriptions:{},wireTaps:new Array(0),unsubscribe:function(e){if(this.subscriptions[e.channel][e.topic]){var t=this.subscriptions[e.channel][e.topic].length,n=0;for(;n<t;n++)if(this.subscriptions[e.channel][e.topic][n]===e){this.subscriptions[e.channel][e.topic].splice(n,1);break}}}},h={1:function(e){if(!e)throw new Error("publishing from the 'global' postal.publish call requires a valid envelope.");return e.channel=e.channel||n,e.timeStamp=new Date,v.configuration.bus.publish(e),e},2:function(e,t){var r={channel:n,topic:e,timeStamp:new Date,data:t};return v.configuration.bus.publish(r),r},3:function(e,t,n){var r={channel:e,topic:t,timeStamp:new Date,data:n};return v.configuration.bus.publish(r),r}},p={1:function(e){var t=e,r,i={};return Object.prototype.toString.call(t)==="[object String]"?(t=n,r=e):(t=e.channel||n,r=e.topic,i=e.options||i),new v.channelTypes[i.type||"local"](t,r)},2:function(e,t){var r=e,i=t,s={};return Object.prototype.toString.call(t)==="[object Object]"&&(r=n,i=e,s=t),new v.channelTypes[s.type||"local"](r,i)},3:function(e,t,n){return new v.channelTypes[n.type||"local"](e,t)}},d={};c.subscriptions[s]={};var v={configuration:{bus:c,resolver:l,DEFAULT_CHANNEL:n,DEFAULT_PRIORITY:r,DEFAULT_DISPOSEAFTER:i,SYSTEM_CHANNEL:s},channelTypes:{local:a},channel:function(){var e=arguments.length;if(p[e])return p[e].apply(this,arguments)},subscribe:function(e){var t=e.callback,r=e.topic,i=e.channel||n;return new f(i,r,t)},publish:function(){var e=arguments.length;if(h[e])return h[e].apply(this,arguments)},addWireTap:function(e){return this.configuration.bus.addWireTap(e)},linkChannels:function(t,r){var i=[];return e.isArray(t)||(t=[t]),e.isArray(r)||(r=[r]),e.each(t,function(t){var s=t.topic||"*";e.each(r,function(r){var s=r.channel||n;i.push(v.subscribe({channel:t.channel||n,topic:t.topic||"*",callback:function(t,n){var i=n;i.topic=e.isFunction(r.topic)?r.topic(n.topic):r.topic||n.topic,i.channel=s,i.data=t,v.publish(i)}}))})}),i},utils:{getSubscribersFor:function(){var e=arguments[0],t=arguments[1],n=[];return arguments.length===1&&(Object.prototype.toString.call(e)==="[object String]"?(e=v.configuration.DEFAULT_CHANNEL,t=arguments[0]):(e=arguments[0].channel||v.configuration.DEFAULT_CHANNEL,t=arguments[0].topic)),v.configuration.bus.subscriptions[e]&&v.configuration.bus.subscriptions[e].hasOwnProperty(t)&&(n=v.configuration.bus.subscriptions[e][t]),n},reset:function(){v.configuration.bus.reset(),v.configuration.resolver.reset()}}};return v}),define("bus",["postal"],function(e){window.postal=e;var t=e.channel("data","*"),n=e.channel("ui","*"),r=e.channel("comm","*");return{data:t,ui:n,comm:r}}),define("infrastructure/ui/router",["backbone","jquery","bus"],function(e,t,n){return e.Router.extend({routes:{"":"root","recipe/new":"editRecipe","recipe/:recipeId/edit":"editRecipe","recipe/:recipeId":"recipe",about:"about"},initialize:function(e){var n=this;t(document).delegate("a.ps-nav","click",function(e){e.preventDefault(),n.navigate(t(this).attr("href"),{trigger:!0})})},activateUI:function(e,t){n.ui.publish({topic:"ui.show",data:{name:e,options:t}})},root:function(){this.activateUI("Home")},editRecipe:function(e){this.activateUI("Edit",{recipeId:e||null})},recipe:function(e,t){this.activateUI("View",{recipeId:e})},about:function(){this.activateUI("About")}})}),define("aspect",["underscore"],function(e){var t=function(){this.views={},this.UI={},this.priorContext=undefined};return t.prototype.registerView=function(e,t,n){this.views[e]=function(){var e;return{rendered:!1,visible:!1,getInstance:function(r){var i=r||{};if(!e||i.forceNew||n)this.visible=this.rendered=!1,e=new t(i.ctorArgs||{});return e},dispose:function(){e&&(typeof e.dispose=="function"&&e.dispose(),e=undefined)}}}()},t.prototype.registerViews=function(t){e.each(t,function(e){this.registerView(e.name,e.ctor)},this)},t.prototype.defineUI=function(t,n,r){var i=e.map(n,function(e){return e.name?e:{name:e,options:{}}}),s=e.extend({events:{}},r),o=this;o.UI[t]={options:s,dependencies:i,activate:function(n){this.options.events.preActivate&&this.options.events.preActivate.call(this);var r=e.extend({},this.options,n||{});r.priorContext=o.priorContext,r.targetContext=t;if(!r.noHide){var i=e.reduce(o.views,function(t,n,r){return n.visible&&!e.any(this.dependencies,function(e){return e.name===r})&&t.push(r),t},[],this);e.each(i,function(e){var t=o.views[e].getInstance();r.disposePrevious?o.views[e].dispose():typeof t.hide=="function"&&t.hide(),o.views[e].visible=!1})}e.each(this.dependencies,function(t){var n=e.extend({},t.options,r),i=o.views[t.name].getInstance(n);o.views[t.name].rendered||(i.render(n),o.views[t.name].rendered=!0),o.views[t.name].visible||(i.show&&i.show(n),o.views[t.name].visible=!0),i.update&&i.update(n)}),o.priorContext=t,this.options.events.postActivate&&this.options.events.postActivate.call(this)}}},t.prototype.defineUIs=function(t){e.each(t,function(e){this.defineUI(e.name,e.dependencies,e.options)},this)},t.prototype.addViewToUI=function(t,n,r){var i=e.isArray(t)?t:[t];this.views[n]||this.registerView(n,r),e.each(i,function(e){this.UI[e]&&this.UI[e].dependencies.push(n)},this)},t}),define("infrastructure/backbone/recipe-app-view",["backbone","bus"],function(e,t){return e.View.extend({vm:{showUI:function(e,n){t.ui.publish({topic:"ui.show",data:{name:e,options:n}})}},dataToJSON:function(){var e;return this.model&&(e=this.model.toJSON()),this.collection&&(e={items:this.collection.toJSON()}),e},render:function(e){return this.trigger("preRender",e),this.$el.html(this.template(this.dataToJSON())),this.trigger("rendered",e),this},show:function(e){this.$el.show(),this.trigger("shown",e)},hide:function(e){this.$el.hide(),this.trigger("hidden",e)},remove:function(){return this.undelegateEvents(),this.$el.remove(),this}})}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){var n=l.readFileSync(e,"utf8");n.indexOf("ï»¿")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"1.0.7",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText)n();else{var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})}},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("text!views/templates/about.html",[],function(){return'<div class="hero-unit">\n	<h3>About \'Ze App\'</h3>\n	<p>\n		Only slightly more complicated than the typical "Todo" introduction app, this app provides some \'thought-fodder\' for developers wanting to extend Backbone.js to better manage concerns like:\n        <ul>\n            <li>View Management</li>\n            <li>Data Synchronization (without unnecessary server round trips)</li>\n            <li>Specialized Collection "Views", customized Model and View objects</li>\n        </ul>\n	</p>\n	<p>\n		Be sure to check out some of the great helper frameworks for ideas as well:\n        <ul>\n            <li><a target="_blank" href="https://github.com/derickbailey/backbone.marionette">Backbone.Marionette</a></li>\n            <li><a target="_blank" href="https://github.com/moviepilot/chaplin">Chaplin</a></li>\n            <li><a target="_blank" href="https://github.com/walmartlabs/thorax">Thorax</a></li>\n            <li><a target="_blank" href="https://github.com/tbranyen/backbone.layoutmanager">Layoutmanager</a></li>\n            <li><a target="_blank" href="https://github.com/addyosmani/backbone-aura">Aura</a></li>\n        </ul>\n	</p>\n</div>'}),define("views/about",["infrastructure/backbone/recipe-app-view","text!views/templates/about.html"],function(e,t){return e.extend({el:"#about",initialize:function(){this.template=_.template(t)}})}),define("text!views/templates/container.html",[],function(){return'<div class="navbar navbar-fixed-top">\n	<div class="navbar-inner">\n		<div class="container-fluid">\n			<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">\n				<span class="icon-bar"></span>\n				<span class="icon-bar"></span>\n				<span class="icon-bar"></span>\n			</a>\n			<a class="brand ps-nav" href="">Ze Recipe Sample App</a>\n			<div class="nav-collapse">\n				<ul class="nav">\n					<li class="active"><a href="" class="ps-nav">Recipe List</a></li>\n					<li><a href="about" class="ps-nav">About</a></li>\n				</ul>\n			</div><!--/.nav-collapse -->\n		</div>\n	</div>\n</div>\n\n<div class="container-fluid wrapper">\n	<div class="row-fluid" id="about"></div>\n	<div class="row-fluid" id="recipe-list"></div>\n	<div class="row-fluid" id="recipe-edit"></div>\n	<div class="row-fluid" id="recipe-view"></div>\n</div>'}),define("views/container",["infrastructure/backbone/recipe-app-view","underscore","jquery","text!views/templates/container.html"],function(e,t,n,r){return e.extend({el:"body",initialize:function(){this.template=t.template(r)}})}),define("infrastructure/backbone/collection-view",["underscore","infrastructure/backbone/recipe-app-view"],function(e,t){return t.extend({constructor:function(){t.prototype.constructor.apply(this,arguments),this.childViews={},this.collection&&(this.collection.on("reset",this.render,this),this.collection.on("add",this.addChild,this),this.collection.on("remove",this.removeChild,this)),e.bindAll(this,"getViewCtor","addChild","removeChild","remove","removeChildren","renderChildAction")},getViewCtor:function(e){var t=this.options.viewType||this.viewType;if(!t)throw new Error("A `viewType` must be specified");return t},addChild:function(e){var t=this.collection.indexOf(e),n=this.getViewCtor(e),r=new n({model:e});this.childViews[r.model.cid]=r,this.renderChildAction(r,t)},renderChildAction:function(e,t){e.render(),this.$el.append(e.$el)},removeChild:function(e){this.childViews[e.cid]&&(this.childViews[e.cid].remove(),delete this.childViews[e.cid])},removeChildView:function(e){this.removeChild(e.model)},removeChildren:function(){e.each(this.childViews,this.removeChildView,this)},remove:function(){return this.removeChildren(),this.undelegateEvents(),this.$el.remove(),this},render:function(e){this.trigger("preRender",e),this.removeChildren(),this.collection.forEach(function(e){this.addChild(e)},this),this.trigger("rendered",e)}})}),define("infrastructure/backbone/recipe-app-model",["backbone","bus"],function(e,t){return e.Model.extend({constructor:function(n,r){this.on("change:id",this.setSubscriptions),e.Model.prototype.constructor.call(this,n,r),this.on("sync",function(e,n,r){t.data.publish({topic:this.url()+".sync",cid:this.cid,data:e.toJSON()})},this)},reset:function(e){var t=this.defaults;typeof this.defaults=="function"&&(t=this.defaults()),this.set(t,e)},validate:function(e){if(this.rules){var t=_.extend(this.toJSON(),e);this.set("_errors",{},{silent:!0});var n={};_.each(e,function(e,r){if(this.rules[r]){var i=_.isArray(e)?e:$.trim(e),s=0,o;for(;s<this.rules[r].length;s++){(function(e){e=e.predicate?e:{predicate:e,errorMsg:"The 'key' has validation errors."},o=e.predicate.call(this,i,t);var s=e.errorMsg;Object.prototype.toString.call(o)==="[object String]"&&(s=o||e.errorMsg,o=!o),o||(n[r]||(n[r]=[]),n[r].push(s))})(this.rules[r][s]);if(!o&&this.rules[r][s].stopIfBroken)break}}},this),this.set("_errors",n,{silent:!0});if(!_.isEmpty(n))return n}},hasErrors:function(){return!_.isEmpty(this.get("_errors"))},routeDataEvent:function(e,t){var n=t.topic.split(".");n[1]==="sync"&&this.set(e)},setSubscriptions:function(){var e=this;e.subscriptions=e.subscriptions||{},e.subscriptions._sync&&e.subscriptions._sync.unsubscribe(),e.subscriptions._sync=t.data.subscribe(e.url()+".*",e.routeDataEvent).withConstraint(function(t,n){return n.cid!==e.cid}).withContext(e)}})}),define("models/recipe-model",["infrastructure/backbone/recipe-app-model","jquery"],function(e,t){var n=function(e){return _.isArray(e)?!!e.length:!!e};return e.extend({urlRoot:"/api/recipe",defaults:function(){return{id:null,title:"",description:"",items:[],steps:[],context:"new"}},getMemento:function(){this.memento=this.toJSON()},applyMemento:function(){this.memento&&this.set(this.memento)},rules:{title:[{predicate:n,errorMsg:"You must include a title."}],description:[{predicate:n,errorMsg:"You must include a description."}],items:[{predicate:n,errorMsg:"You must include at least one required item."}],steps:[{predicate:n,errorMsg:"You must include at least one step."}]}})}),define("models/recipe-list-model",["backbone","jquery","models/recipe-model","bus"],function(e,t,n,r){return e.Collection.extend({url:"/api/recipe",model:n,initialize:function(){this.setSubscriptions()},routeDataEvent:function(e,t){var n=t.topic.split(".");if(n[1]==="sync"){var r=this.get(e.id);r?r.set(e):this.fetch()}},setSubscriptions:function(){var e=this;e.subscriptions=e.subscriptions||{},e.subscriptions._sync&&e.subscriptions._sync.unsubscribe(),e.subscriptions._sync=r.data.subscribe(e.url+"*",e.routeDataEvent).withContext(e)}})}),define("text!views/templates/recipe-list.html",[],function(){return'<h2>Recipes</h2>\n\n<table id="recipe-items" class="table table-bordered table-striped table-condensed recipe-list">\n	<thead>\n		<tr>\n			<th>Recipe Title</th>\n			<th></th>\n		</tr>\n	</thead>\n	<tbody>\n		<tr id="no-recipes-placeholder">\n			<td colspan="2">\n				<em>No recipes exist at the moment...</em>\n			</td>\n		</tr>\n	</tbody>\n	<tfoot>\n		<tr>\n			<td colspan="2" class="footer-bg">\n				<div>\n					<a id="new-recipe" href="" class="ps-nav btn btn-inverse">Add a Recipe</a>\n				</div>\n			</td>\n		</tr>\n	</tfoot>\n</table>'}),define("text!views/templates/recipe-item.html",[],function(){return'<td>\n    <a href="recipe/<%= id %>" class="ps-nav"><%= title %></a>\n</td>\n<td>\n    <a href="recipe/<%= id %>/edit" class="ps-nav"><i class="icon-edit"></i></a>\n    <a href="" class="ps-nav remove-recipe" data-val="<%= id %>"><i class="icon-remove"></i></a>\n</td>'}),define("views/recipe-item",["backbone","underscore","infrastructure/backbone/recipe-app-view","text!views/templates/recipe-item.html"],function(e,t,n,r){return n.extend({tagName:"tr",events:{"click .remove-recipe":"removeRecipe"},initialize:function(){t.bindAll(this),this.template=t.template(r),this.model.on("change",this.render,this)},removeRecipe:function(e){e.preventDefault(),this.model.destroy()}})}),define("views/recipe-list",["infrastructure/backbone/collection-view","underscore","jquery","models/recipe-list-model","text!views/templates/recipe-list.html","views/recipe-item"],function(e,t,n,r,i,s){return e.extend({el:"#recipe-list",viewType:s,events:{"click #new-recipe":"addNewRecipe"},initialize:function(){t.bindAll(this),this.template=t.template(i),this.on("preRender",function(){this.viewRendered||(this.$el.html(this.template()),this.viewRendered=!0)}),app.models.recipes=this.collection=new r,this.collection.on("add remove reset",function(){this.applyPlaceholder()},this),this.collection.fetch()},renderChildAction:function(e,t){e.render(),this.$("#recipe-items tbody").append(e.$el)},applyPlaceholder:function(){this.collection.length?this.$("#no-recipes-placeholder").hide():this.$("#no-recipes-placeholder").show()},addNewRecipe:function(){this.vm.showUI("Edit",{context:"new"})}})}),define("text!views/templates/recipe-view.html",[],function(){return'<div>\n    <h2>Viewing Recipe:</h2>\n    <p><em>Title:</em> <strong id="title"><%= title %></strong></p>\n    <p><em>Description:</em> <span id="description"><%= description %></span></p>\n    <div><em>Items Required:</em></div>\n    <ul id="items">\n        <% _.each(items, function(item) { %>\n        <li><%= item %></li>\n        <% }) %>\n    </ul>\n    <div><em>Steps:</em></div>\n    <ol id="steps">\n        <% _.each(steps, function(step) { %>\n        <li><%= step %></li>\n        <% }) %>\n    </ol>\n    <input class="btn btn-primary" type="button" value="Go Back to Recipe List" id="addCancel"> <a id="editRecipe" href="/recipe/<%= id %>/edit" class="ps-nav btn">Edit This Recipe</a>\n</div>'}),define("text!views/templates/items-template.html",[],function(){return'<% if(!items.length) { %>\n	<em id="items">No items yet...</em>\n<% } else { %>\n	<div id="items">\n	<% _.each(items, function(item, idx) { %>\n	<div><a href="" data-list="items" data-val="<%= idx %>" class="item-remove"><i class="icon-remove"></i>&nbsp;</a><%= item %></div>\n	<% }) %>\n	</div>\n<% } %>'}),define("text!views/templates/steps-template.html",[],function(){return'<% if(!items.length) { %>\n	<em id="steps">No steps yet...</em>\n<% } else { %>\n	<div id="steps">\n	<% _.each(items, function(step, idx) { %>\n	<div><a href="" data-list="steps" data-val="<%= idx %>" class="item-remove"><i class="icon-remove"></i></a>&nbsp;<%= idx + 1 %>.)&nbsp;<%= step %></div>\n	<% }) %>\n	</div>\n<% } %>'}),define("views/recipe-view",["infrastructure/backbone/recipe-app-view","underscore","jquery","text!views/templates/recipe-view.html","text!views/templates/items-template.html","text!views/templates/steps-template.html","models/recipe-model"],function(e,t,n,r,i,s,o){return e.extend({el:"#recipe-view",events:{"click #addCancel":"onGoBack"},initialize:function(){t.bindAll(this),this.template=t.template(r),this.templates={items:t.template(i),steps:t.template(s)},this.setUpModel()},onGoBack:function(){history.back()},renderItems:function(){this.renderList("items")},renderSteps:function(){this.renderList("steps")},renderList:function(e){var t=this.templates[e]({items:this.model.get(e)});this.$("#"+e).replaceWith(t)},setUpModel:function(){this.model=new o,this.model.bind("change",this.render),this.model.CONTEXT="VIEW"},update:function(e){var n;this.priorUI=e.priorContext,this.model.reset({silent:!0}),e.recipeId&&(n=app.models.recipes.get(e.recipeId))&&this.model.set(t.deepExtend({},n.toJSON()))}})}),define("text!views/templates/recipe-edit.html",[],function(){return'<form class="form-horizontal">\n    <fieldset>\n        <legend>\n            <% if(id === null) { %>\n            Adding New Recipe:\n            <% } else { %>\n            Editing Recipe:\n            <% } %>\n        </legend>\n        <div class="control-group">\n            <label class="control-label" for="title">Title</label>\n            <div class="controls">\n                <input type="text" class="input-xlarge text-updateable" id="title" value="<%= title %>">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="title">Description</label>\n            <div class="controls">\n                <input type="text" class="input-xlarge text-updateable" id="description" value="<%= description %>">\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="title">Items</label>\n            <div class="controls">\n                <input type="text" class="input-xlarge" id="items_add"> <input type="button" value="Add" id="btnAddItem">\n                <div>\n                    <span id="items"></span>\n                </div>\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="title">Steps</label>\n            <div class="controls">\n                <input type="text" class="input-xlarge" id="steps_add"> <input type="button" value="Add" id="btnAddStep">\n                <div>\n                    <span id="steps"></span>\n                </div>\n            </div>\n        </div>\n        <div class="control-group">\n            <div class="controls">\n                <% if(id === null) { %>\n                <input class="btn btn-primary" type="button" value="Add" id="addNew">\n                <input class="btn" type="button" value="Cancel" id="addCancel">\n                <% } else { %>\n                <input class="btn btn-primary" type="button" value="Save" id="updateRecipe">\n                <input class="btn" type="button" value="Cancel Edit" id="saveCancel">\n                <% } %>\n            </div>\n        </div>\n    </fieldset>\n    <div id="errors"></div>\n</form>'}),define("text!views/templates/error.html",[],function(){return'<div class="alert alert-error">\n	<ul>\n		<% _.each(errors, function(error){ %>\n			<li><%= error %></li>\n		<% }) %>\n	</ul>\n</div>'}),define("views/recipe-edit",["infrastructure/backbone/recipe-app-view","underscore","jquery","text!views/templates/recipe-edit.html","text!views/templates/items-template.html","text!views/templates/steps-template.html","text!views/templates/error.html","models/recipe-model"],function(e,t,n,r,i,s,o,u){return e.extend({el:"#recipe-edit",events:{"click #addCancel":"onGoBack","click #saveCancel":"onGoBack","click #addNew":"onAddNewRecipe","click #btnAddItem":"onAddItem","click #btnAddStep":"onAddStep","click .item-remove":"onRemoveItem","change .text-updateable":"updateValueFromDom","click #updateRecipe":"updateRecipe"},initialize:function(e){t.bindAll(this),this.options=e,this.templates={main:t.template(r),items:t.template(i),steps:t.template(s),error:t.template(o)},this.setUpModel()},onAddItem:function(){this.onAdd("items")},onAddNewRecipe:function(){this._context="new",this.model.save()},onAddStep:function(){this.onAdd("steps")},onAdd:function(e){var t=this.$el.find("#"+e+"_add"),n=t.val();t.val(""),this.model.set(e,this.model.get(e).concat(n),{silent:!0}),this.model.change(),t.focus()},onGoBack:function(){this._context&&this._context==="new"?(this._context="",this.vm.showUI("Home")):history.back()},onRemoveItem:function(e){e.preventDefault();var r=n(e.currentTarget),i=r.attr("data-list"),s=r.attr("data-val"),o=t.clone(this.model.get(i));o.splice(s,1),this.model.set(i,o,{silent:!0}),this.render()},render:function(e){this.$el.html(this.templates.main(this.model.toJSON())),this.renderItems(),this.renderSteps()},renderItems:function(){this.renderList("items")},renderSteps:function(){this.renderList("steps")},renderList:function(e){var t=this.templates[e]({items:this.model.get(e)});this.$("#"+e).replaceWith(t)},setUpModel:function(){this.model=new u,this.model.on("change",this.render),this.model.on("error",this.showErrors),this.model.on("sync",function(){this.onGoBack()},this),this.model.CONTEXT="EDIT"},showErrors:function(e,n){var r=t.flatten(n);if(r&&r.length){this.$("#errors").html(this.templates.error({errors:r}));return}this.$("#errors").html("")},update:function(e){var n;this.priorUI=e.priorContext,this.model.reset({silent:!0}),e.recipeId?(n=app.models.recipes.get(e.recipeId))&&this.model.set(t.deepExtend({},n.toJSON())):this.model.change()},updateValueFromDom:function(e){var t=n(e.currentTarget);this.model.set(t.attr("id"),t.val(),{silent:!0})},updateRecipe:function(){var e=this;e.model.save()}})}),define("infrastructure/ui/viewAssets",["views/about","views/container","views/recipe-list","views/recipe-view","views/recipe-edit"],function(e,t,n,r,i){return{load:function(s){s.registerViews([{name:"About",ctor:e},{name:"Container",ctor:t},{name:"RecipeList",ctor:n},{name:"RecipeView",ctor:r},{name:"RecipeEdit",ctor:i}]),s.defineUIs([{name:"Home",dependencies:["Container","RecipeList"],options:{}},{name:"About",dependencies:["Container","About"],options:{}},{name:"View",dependencies:["Container","RecipeView"],options:{}},{name:"Edit",dependencies:["Container","RecipeEdit"],options:{}}])}}}),define("libs/postal/postal.diagnostics",["postal","underscore"],function(e,t,n){e.diagnostics=e.diagnostics||{};var r=function(n,r,i){var s=this;s.filters=i||[],s.active=!0,s.removeWireTap=e.addWireTap(function(e,n){if(!s.active)return;if(!s.filters.length||t.any(s.filters,function(e){return s.applyFilter(e,n)})){if(!JSON)throw"This browser or environment does not provide JSON support";try{r(JSON.stringify(n,null,4))}catch(i){try{var o=t.extend({},n);delete o.data,r(JSON.stringify(o,null,4)+"\n	"+"JSON.stringify Error: "+i.message)}catch(u){r("Unable to parse data to JSON: "+i)}}}}),e.diagnostics[n]&&e.diagnostics[n].removeWireTap(),e.diagnostics[n]=s};return r.prototype.applyFilter=function(e,n){var r=0,i=0;return t.each(e,function(e,s){n[s]&&(i++,t.isRegExp(e)&&e.test(n[s])?r++:t.isObject(n[s])&&!t.isArray(n[s])?this.applyFilter(e,n[s])&&r++:t.isEqual(n[s],e)&&r++)},this),r===i},r.prototype.clearFilters=function(){this.filters=[]},r.prototype.removeFilter=function(e){this.filters=t.filter(this.filters,function(n){return!t.isEqual(n,e)})},r.prototype.addFilter=function(e){t.isArray(e)||(e=[e]),t.each(e,function(e){(this.filters.length===0||!t.any(this.filters,function(n){return t.isEqual(n,e)}))&&this.filters.push(e)},this)},r}),define("app",["backbone","bus","infrastructure/ui/router","aspect","infrastructure/ui/viewAssets","libs/postal/postal.diagnostics"],function(e,t,n,r,i,s){var o=!0,u={viewManager:new r,router:undefined,models:{},views:{},init:function(){this.router=new n({app:this}),e.history.start({pushState:!0})},bus:{ui:new s("ui-channel",function(e){console.log(e)},[{channel:"ui"}]),data:new s("data-channel",function(e){console.log(e)},[{channel:"data"}]),comm:new s("comm-channel",function(e){console.log(e)},[{channel:"comm"}])},appLog:function(e){if(!e)return o;o=e}};return _.bind(u.init,u),t.ui.subscribe("ui.show",function(e,t){this.UI[e.name].activate(e.options)}).withContext(u.viewManager),i.load(u.viewManager),u}),require.config({paths:{text:"libs/text",backbone:"libs/backbone",underscore:"libs/underscore",app:"infrastructure/app",postal:"libs/postal/postal",mockjax:"libs/jquery-mockjax-1.4.0",aspect:"libs/aspect/aspect",bus:"infrastructure/comm/bus"},shim:{mockjax:["jquery"]}}),require(["backbone","jquery","underscore","infrastructure/comm/resource-mocks","libs/deepExtend"],function(){require(["app"],function(e){window.app=e,e.init()})}),define("main",function(){})